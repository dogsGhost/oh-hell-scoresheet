// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r;n=function(){function e(e){this.name=e;this.hands=[];this.totalScore=0}return e}();e=function(){function e(e){this.bid=e;this.pointsEarned=0;this.correctBid=!1}e.prototype.scoreHand=function(e){if(e==="correct"){this.correctBid=!0;this.pointsEarned=this.bid*t.game.settings.trickValue+t.game.settings.correctBidValue}};return e}();r={transitionEnd:"",transitionCheck:function(){var e;e=document.getElementById("container");e.style.transitionDelay===""?this.transitionEnd="transitionend":e.style.WebkitTransitionDelay===""&&(this.transitionEnd="webkitTransitionEnd")},maxArray:function(e){return Math.max.apply(null,e)},trimCheck:function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})},transitionCallback:function(e){return this.transitionEnd?e.on(this.transitionEnd,function(){return e.remove()}):window.alert("Sorry, this browser is currently not supported.")}};t={init:function(){this.setButtons();this.cacheVariables();this.bindNewGame();return r.transitionCheck()},setButtons:function(){$("button").each(function(){if(!$(this).hasClass("ui-button"))return $(this).button()});return $(".js-radioset").each(function(){if(!$(this).hasClass("ui-buttonset"))return $(this).buttonset()})},cacheVariables:function(){this.$namesFormTemplate=Handlebars.compile($("#namesFormTemplate").html());this.$biddingFormTemplate=Handlebars.compile($("#biddingFormTemplate").html());this.$correctBidsFormTemplate=Handlebars.compile($("#correctBidsFormTemplate").html());this.$scoreBoardTemplate=Handlebars.compile($("#scoreBoardTemplate").html());this.$newGameBtn=$("#newGameBtn");this.$container=$("#container");this.$numPlayersSection=$("#numPlayersSection");this.previousHands="";this.gameStarted=!1;this.game={players:[],settings:{}}},bindNewGame:function(){this.$newGameBtn.on("click",this.startNewGame);return this.$numPlayersSection.on("click","button",this.setNumPlayers)},startNewGame:function(){t.gameStarted?t.resetGame():t.gameStarted=!0;return t.$numPlayersSection.removeClass("hide")},resetGame:function(){this.game={players:[],settings:{}};this.previousHands="";this.$numPlayersSection.addClass("hide");return $("#scoringForm").addClass("hide").nextAll().remove()},setNumPlayers:function(){var e;t.game.settings.numPlayers=parseInt($("#numPlayersSection input:checked").val(),10);e=t.game.settings.numPlayers;t.game.settings.maxNumCards=e<=5?10:Math.floor(52/e);return t.renderNamesForm()},renderNamesForm:function(){var e,t;this.$numPlayersSection.addClass("hide");t={count:function(){var t,n,r;r=[];for(e=t=1,n=this.game.settings.numPlayers;1<=n?t<=n:t>=n;e=1<=n?++t:--t)r.push(e);return r}.call(this)};this.$container.append(this.$namesFormTemplate(t));this.setButtons();return $("#namesForm").on("submit",this.setPlayerNames).removeClass("hide")},setPlayerNames:function(e){var i,s,o,u,a;e.preventDefault();o=$(this).serializeArray();for(i=u=0,a=o.length;u<a;i=++u){s=o[i];s.value||(s.value="Player "+(i+1));t.game.players.push(new n(s.value.trim()))}r.transitionCallback($(this));$(this).addClass("hide");return t.showScoringForm()},showScoringForm:function(){return $("#scoringForm").on("submit",this.setScoringParams).removeClass("hide")},setScoringParams:function(e){var n,r,i,s,o,u,a,f,l;e.preventDefault();s=$(this).serializeArray();if(parseInt(s[0].value,10)===0){r=function(){var e,n,r;r=[];for(i=e=1,n=t.game.settings.maxNumCards;1<=n?e<=n:e>=n;i=1<=n?++e:--e)r.push(i);return r}();for(i=u=f=t.game.settings.maxNumCards-1;f<=1?u<=1:u>=1;i=f<=1?++u:--u)r.push(i)}else{r=function(){var e,n,r;r=[];for(i=e=n=t.game.settings.maxNumCards;n<=1?e<=1:e>=1;i=n<=1?++e:--e)r.push(i);return r}();for(i=a=2,l=t.game.settings.maxNumCards;2<=l?a<=l:a>=l;i=2<=l?++a:--a)r.push(i)}t.game.settings.handSizeOrder=r;o=parseInt(s[1].value,10);t.game.settings.trickValue=o?o:1;n=parseInt(s[2].value,10);t.game.settings.correctBidValue=n?n:5;$(this).addClass("hide");return t.renderBiddingForm()},renderBiddingForm:function(){var e,t;e=this.game;e.handNum=e.players[0].hands.length+1;e.numCards=e.settings.handSizeOrder[e.handNum-1];e.count=function(){var n,r,i;i=[];for(t=n=0,r=e.numCards;0<=r?n<=r:n>=r;t=0<=r?++n:--n)i.push(t);return i}();e.numCards+=e.numCards>1?" cards":" card";this.$container.append(this.$biddingFormTemplate(e));this.setButtons();return $("#biddingForm").on("submit",this.setPlayerBids).removeClass("hide").next().on("click","button",this.renderCorrectBidsForm)},setPlayerBids:function(n){var i,s,o,u,a,f,l,c;n.preventDefault();s=$(this).serializeArray();c=t.game.players;for(u=0,f=c.length;u<f;u++){o=c[u];for(a=0,l=s.length;a<l;a++){i=s[a];o.name===i.name&&o.hands.push(new e(i.value))}}r.transitionCallback($(this));return $(this).addClass("hide").next().removeClass("hide").end()},renderCorrectBidsForm:function(){var e,n,i,s,o,u,a;e={players:[]};n=t.game.players[0].hands.length-1;a=t.game.players;for(o=0,u=a.length;o<u;o++){s=a[o];i={name:s.name,bid:s.hands[n].bid};i.bid+=i.bid==="1"?" trick":" tricks";e.players.push(i)}t.$container.append(t.$correctBidsFormTemplate(e));t.setButtons();t.$correctBidsForm=$("#correctBidsForm");r.transitionCallback($(this).parent());$(this).parent().addClass("hide");return t.$correctBidsForm.on("submit",t.calcBids).removeClass("hide")},calcBids:function(e){var n,r,i,s,o,u,a,f,l;e.preventDefault();s=$(this).serializeArray();n=t.game.players[0].hands.length-1;l=t.game.players;for(o=0,a=l.length;o<a;o++){r=l[o];for(u=0,f=s.length;u<f;u++){i=s[u];if(i.name===r.name){r.hands[n].scoreHand(i.value);r.totalScore+=r.hands[n].pointsEarned}}}return t.renderScoreBoard()},renderScoreBoard:function(){var e,n,i,s,o,u,a,f,l;i=this.game;i.handNum=i.players[0].hands.length;i.prevHand=this.previousHands;e=function(){var e,t,r,s;r=i.players;s=[];for(e=0,t=r.length;e<t;e++){n=r[e];s.push(n.totalScore)}return s}();e=r.maxArray(e);f=i.players;for(s=0,u=f.length;s<u;s++){n=f[s];n.totalScore===e&&(n.winning=!0)}this.$container.append(this.$scoreBoardTemplate(i));this.setButtons();r.transitionCallback(t.$correctBidsForm);t.$correctBidsForm.next().on("click","button",t.playNextHand).find("tbody").append(i.prevHand).end().removeClass("hide").end().addClass("hide");this.previousHands=$("tbody").html();l=i.players;for(o=0,a=l.length;o<a;o++){n=l[o];n.winning=!1}},playNextHand:function(){r.transitionCallback($(this).parent());$(this).parent().addClass("hide");return t.renderBiddingForm()}};t.init()}).call(this);